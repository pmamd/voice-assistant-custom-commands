<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 700" width="800" height="700">
  <defs>
    <style>
      .box { fill: #f0f0f0; stroke: #333; stroke-width: 2; }
      .main-app { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .server { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .component { fill: #ffffff; stroke: #666; stroke-width: 1.5; }
      .text { font-family: Arial, sans-serif; font-size: 14px; fill: #333; }
      .text-small { font-family: Arial, sans-serif; font-size: 12px; fill: #666; }
      .text-label { font-family: Arial, sans-serif; font-size: 11px; fill: #888; font-style: italic; }
      .title { font-family: Arial, sans-serif; font-size: 16px; fill: #1976d2; font-weight: bold; }
      .arrow { fill: none; stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-thick { fill: none; stroke: #1976d2; stroke-width: 2.5; marker-end: url(#arrowhead-blue); }
      .icon-text { font-family: Arial, sans-serif; font-size: 20px; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976d2" />
    </marker>
  </defs>

  <!-- Microphone -->
  <rect x="320" y="20" width="160" height="50" rx="5" class="box"/>
  <text x="400" y="50" text-anchor="middle" class="text">ðŸŽ¤ Microphone</text>

  <!-- Arrow to main app -->
  <path d="M 400 70 L 400 120" class="arrow"/>
  <text x="420" y="100" class="text-label">(audio input, including commands)</text>

  <!-- Main App Container -->
  <rect x="50" y="120" width="700" height="280" rx="8" class="main-app"/>
  <text x="400" y="145" text-anchor="middle" class="title">talk-llama-custom (Main App)</text>

  <!-- Whisper STT -->
  <rect x="80" y="170" width="140" height="80" rx="5" class="component"/>
  <text x="150" y="200" text-anchor="middle" class="text">Whisper</text>
  <text x="150" y="220" text-anchor="middle" class="text">STT</text>

  <!-- LLaMA LLM -->
  <rect x="320" y="170" width="140" height="80" rx="5" class="component"/>
  <text x="390" y="200" text-anchor="middle" class="text">LLaMA</text>
  <text x="390" y="220" text-anchor="middle" class="text">LLM</text>

  <!-- Arrow: Whisper to LLaMA -->
  <path d="M 220 210 L 320 210" class="arrow"/>
  <text x="270" y="205" text-anchor="middle" class="text-small">(normal text)</text>

  <!-- TTS Client -->
  <rect x="320" y="290" width="140" height="80" rx="5" class="component"/>
  <text x="390" y="320" text-anchor="middle" class="text">TTS</text>
  <text x="390" y="340" text-anchor="middle" class="text">Client</text>

  <!-- Arrow: LLaMA to TTS -->
  <path d="M 390 250 L 390 290" class="arrow"/>

  <!-- Arrow: Whisper to TTS (bypass) -->
  <path d="M 150 250 Q 150 330 320 330" class="arrow"/>
  <text x="180" y="300" class="text-label">commands (bypass)</text>

  <!-- Arrow: TTS to Server -->
  <path d="M 390 370 L 390 440" class="arrow-thick"/>
  <text x="410" y="405" class="text-label">HTTP POST</text>
  <text x="410" y="420" class="text-label">{text: "...", ...}</text>

  <!-- Wyoming-Piper Server -->
  <rect x="250" y="440" width="300" height="240" rx="8" class="server"/>
  <text x="400" y="465" text-anchor="middle" class="title">wyoming-piper</text>
  <text x="400" y="483" text-anchor="middle" class="text-small">TTS Server</text>

  <!-- Command Detection -->
  <rect x="280" y="500" width="240" height="50" rx="5" class="component"/>
  <text x="400" y="520" text-anchor="middle" class="text-small">Command Detection</text>
  <text x="400" y="535" text-anchor="middle" class="text-small">(e.g., "stop")</text>

  <!-- Piper Synthesis -->
  <rect x="280" y="565" width="240" height="40" rx="5" class="component"/>
  <text x="400" y="590" text-anchor="middle" class="text">Piper Synthesis</text>

  <!-- aplay -->
  <rect x="280" y="620" width="240" height="40" rx="5" class="component"/>
  <text x="400" y="645" text-anchor="middle" class="text">aplay (Audio Out)</text>

  <!-- Arrows within server -->
  <path d="M 400 550 L 400 565" class="arrow"/>
  <path d="M 400 605 L 400 620" class="arrow"/>

  <!-- Speaker -->
  <text x="570" y="650" class="icon-text">ðŸ”Š</text>
  <text x="595" y="650" class="text">Speaker</text>

  <!-- Arrow to speaker -->
  <path d="M 520 640 L 565 640" class="arrow-thick"/>

</svg>
